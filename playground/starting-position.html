<!doctype html>
<html>
<title>Chess view</title>
<head>
<style>

</style>
</head>
<body>
<link rel="stylesheet" href="../theme/base/style.css">
<div id="chessview"></div>
<script src="../vendor/chesslib.js"></script>
<script src="../browser/chessview.js"></script>
<script>
var mercury = require('mercury');
var chesslib = require('chesslib');
var chessview = require('chessview');
var FEN = chesslib.FEN;
var playable = chessview.playable;

var state = playable(fromQuery());

mercury.app(
  document.getElementById('chessview'),
  state,
  playable.board
);

var h = mercury.h;

var rotated = mercury.input();
rotated(function (value) {
  state.rotated.set(value.rotated);
});

function fromQuery() {
    var search = location.search;
    if (!search) {
      return FEN.standardPosition;
    }
    var plainSearch = decodeURIComponent(location.search.replace('?', ''));
    switch (plainSearch.toLowerCase()) {
    case '960':
    case 'ninesixty':
    case 'fischerandom':
      return chesslib.fischerandom();
    case 'doublefischerandom':
      return chesslib.doubleFischerandom();
    default:
      return FEN.parse(plainSearch);
    }
}

function position(p) {
    if (p == null) {
      return state.position();
    }
    else {
      state.position.set(p);
    }
}
</script>
